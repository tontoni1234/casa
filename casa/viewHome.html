<!--
   viewHome.html  version 1.9.1  

   Sweet Home 3D, Copyright (c) 2024 Space Mushrooms <info@sweethome3d.com>

   This program is free software; you can redistribute it and/or modify
   it under the terms of the GNU General Public License as published by
   the Free Software Foundation; either version 2 of the License, or
   (at your option) any later version.

   This program is distributed in the hope that it will be useful,
   but WITHOUT ANY WARRANTY; without even the implied warranty of
   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
   GNU General Public License for more details.

   You should have received a copy of the GNU General Public License
   along with this program; if not, write to the Free Software
   Foundation, Inc., 59 Temple Place, Suite 330, Boston, MA  02111-1307  USA
-->
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>View home with Sweet Home 3D HTML5 Viewer</title>

<!--  Copy the following scripts in your page header -->
<script type="text/javascript" src="lib/big.min.js"></script>
<script type="text/javascript" src="lib/gl-matrix-min.js"></script>
<script type="text/javascript" src="lib/jszip.min.js"></script>
<script type="text/javascript" src="lib/core.min.js"></script>
<script type="text/javascript" src="lib/geom.min.js"></script>
<script type="text/javascript" src="lib/stroke.min.js"></script>
<script type="text/javascript" src="lib/batik-svgpathparser.min.js"></script>
<script type="text/javascript" src="lib/jsXmlSaxParser.min.js"></script>
<script type="text/javascript" src="lib/triangulator.min.js"></script>
<script type="text/javascript" src="lib/viewmodel.min.js"></script>
<script type="text/javascript" src="lib/viewhome.min.js"></script>

<style type="text/css">
/* The class of components handled by the viewer */
.viewerComponent  {
}

/* --- Responsive layout (Option 2) --- */
html, body {
  margin: 0;
  padding: 0;
  height: 100%;
}

/* Make canvas adapt to screen (mobile + desktop) */
#viewerCanvas {
  width: 100vw;
  height: 92vh;
  display: block;
  background-color: #CCCCCC;
  border: 1px solid gray;
  outline: none;
}

/* Center and scale the progress box on small screens */
#viewerProgressDiv {
  width: min(400px, 90vw) !important;
  position: absolute !important;
  top: 40vh !important;
  left: 50vw !important;
  transform: translate(-50%, -50%) !important;
  background-color: rgba(128, 128, 128, 0.7);
  padding: 20px;
  border-radius: 25px;
}

/* Keep nav in bottom-left (even if hidden) */
#viewerNavigationDiv {
  position: absolute;
  bottom: 5px;
  left: 5px;
}
</style>
</head>

<body>
<div>
  <!-- Canvas: no fixed width/height attributes -->
  <canvas id="viewerCanvas" class="viewerComponent" tabIndex="1"></canvas>

  <div id="viewerProgressDiv">
    <progress id="viewerProgress" class="viewerComponent" value="0" max="200" style="width: min(400px, 90vw)"></progress>
    <label id="viewerProgressLabel" class="viewerComponent" style="margin-top: 2px; display: block; margin-left: 10px"></label>
  </div>

  <div id="viewerNavigationDiv" style="margin-top: -60px">
    <input id="aerialView" class="viewerComponent" name="cameraType" type="radio" style="visibility: hidden;"/>
      <label class="viewerComponent" for="aerialView" style="visibility: hidden;">Aerial view</label>
    <input id="virtualVisit" class="viewerComponent" name="cameraType" type="radio" style="visibility: hidden;"/>
      <label class="viewerComponent" for="virtualVisit" style="visibility: hidden;">Virtual visit</label>
    <select id="levelsAndCameras" class="viewerComponent" style="visibility: hidden;"></select>
  </div>
</div>

<div style="position: absolute; bottom: 5px; text-align: center; width: 95%; z-index: -1">
  <a href="http://www.sweethome3d.com">Sweet Home 3D</a> HTML5 Viewer / Version 1.9.1 - Distributed under GNU General Public License
</div>

<!-- Copy the following script to view your home in the previous canvas -->
<script type="text/javascript">
  var homeUrl = "casa.zip";

  var onerror = function(err) {
      if (err == "No WebGL") {
        alert("Sorry, your browser doesn't support WebGL.");
      } else {
        console.log(err.stack);
        alert("Error: " + (err.message  ? err.constructor.name + " " +  err.message  : err)
              + (window.location.href.indexOf("file://") === 0 ? "\nCheck your browser is allowed to access local files." : ""));
      }
    };

  var onprogression = function(part, info, percentage) {
      var progress = document.getElementById("viewerProgress"); 
      if (part === HomeRecorder.READING_HOME) {
        progress.value = percentage * 100;
        info = info.substring(info.lastIndexOf('/') + 1);
      } else if (part === Node3D.READING_MODEL) {
        progress.value = 100 + percentage * 100;
        if (percentage === 1) {
          document.getElementById("viewerProgressDiv").style.visibility = "hidden";
        }
      }

      document.getElementById("viewerProgressLabel").innerHTML = 
          (percentage ? Math.floor(percentage * 100) + "% " : "") + part + " " + info;
    };

  // Display home in canvas 3D
  viewHome("viewerCanvas",
           homeUrl,
           onerror,
           onprogression,
          {roundsPerMinute: 0,
           navigationPanel: "none",
           aerialViewButtonId: "aerialView",
           virtualVisitButtonId: "virtualVisit",
           levelsAndCamerasListId: "levelsAndCameras",
           activateCameraSwitchKey: true
          });

  // --- Important fix: keep WebGL canvas resolution synced with CSS size ---
  function resizeCanvas() {
    const c = document.getElementById('viewerCanvas');
    // Match drawing buffer size to displayed size (prevents blur / wrong aspect ratio)
    c.width  = Math.max(1, c.clientWidth);
    c.height = Math.max(1, c.clientHeight);
  }
  window.addEventListener('resize', resizeCanvas);
  window.addEventListener('orientationchange', resizeCanvas);
  // First sizing after initial layout
  setTimeout(resizeCanvas, 200);
</script>

</body>
</html>
